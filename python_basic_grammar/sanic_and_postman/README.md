# Sanic and Postman

Sanic æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºå¼‚æ­¥ï¼ˆasynchronousï¼‰Webåº”ç”¨çš„Pythonæ¡†æ¶ï¼Œå®ƒåŸºäº Python 3.5+ å¼•å…¥çš„ `async/await` è¯­æ³•ï¼Œæ—¨åœ¨æä¾›é«˜æ€§èƒ½çš„ Web æœåŠ¡å™¨å’Œè·¯ç”±å¤„ç†åŠŸèƒ½ã€‚å®ƒçš„è®¾è®¡çµæ„Ÿæ¥è‡ªäº Flaskï¼Œä½†å¼ºè°ƒäº†å¼‚æ­¥å¤„ç†ï¼Œé€‚ç”¨äºé«˜å¹¶å‘çš„åº”ç”¨ã€‚<br>

- [Sanic and Postman](#sanic-and-postman)
  - [Sanicçš„å®‰è£…](#sanicçš„å®‰è£…)
  - [ç®€å•sanicåº”ç”¨ç¤ºä¾‹ï¼š](#ç®€å•sanicåº”ç”¨ç¤ºä¾‹)
  - [ä½¿ç”¨postmanæµ‹è¯•sanicå¯åŠ¨çš„æœåŠ¡ï¼š](#ä½¿ç”¨postmanæµ‹è¯•sanicå¯åŠ¨çš„æœåŠ¡)
  - [GETå’ŒPOSTæ–¹æ³•ï¼š](#getå’Œpostæ–¹æ³•)
    - [GET æ–¹æ³•è¿›é˜¶ï¼š](#get-æ–¹æ³•è¿›é˜¶)
    - [POST æ–¹æ³•ï¼š](#post-æ–¹æ³•)
    - [POST æ–¹æ³•è·¯ç”±çš„æµ‹è¯•ï¼š](#post-æ–¹æ³•è·¯ç”±çš„æµ‹è¯•)
    - [Postman ä¸­ Body é€‰é¡¹çš„å«ä¹‰ä¸é€‰æ‹©ï¼š](#postman-ä¸­-body-é€‰é¡¹çš„å«ä¹‰ä¸é€‰æ‹©)
  - [request å¯¹è±¡ï¼š](#request-å¯¹è±¡)
  - [response å¯¹è±¡ï¼š](#response-å¯¹è±¡)
  - [ä½¿ç”¨ Postman åŠ¨æ€æ›´æ–°SanicæœåŠ¡ä¸­ç±»å±æ€§ï¼š](#ä½¿ç”¨-postman-åŠ¨æ€æ›´æ–°sanicæœåŠ¡ä¸­ç±»å±æ€§)
    - [åœ¨ä¸»æ–‡ä»¶ä¸­å®šä¹‰è·¯ç”±ï¼š](#åœ¨ä¸»æ–‡ä»¶ä¸­å®šä¹‰è·¯ç”±)
    - [é™„å±æ–‡ä»¶ä¸­å®šä¹‰ç”¨æˆ·è¾“å‡ºçš„å¤„ç†æµç¨‹ï¼š](#é™„å±æ–‡ä»¶ä¸­å®šä¹‰ç”¨æˆ·è¾“å‡ºçš„å¤„ç†æµç¨‹)
    - [å·¥å…·å‹å‡½æ•°ä¸­å®šä¹‰æ–‡æœ¬å¤„ç†ã€å˜é‡æ›´æ–°ç»†èŠ‚ï¼š](#å·¥å…·å‹å‡½æ•°ä¸­å®šä¹‰æ–‡æœ¬å¤„ç†å˜é‡æ›´æ–°ç»†èŠ‚)
    - [è¿è¡Œæ–¹å¼ï¼š](#è¿è¡Œæ–¹å¼)
  - [ä½¿ç”¨Postman+globalåŠ¨æ€æ›´æ–°SanicæœåŠ¡ä¸­çš„æ•°æ®ï¼š](#ä½¿ç”¨postmanglobalåŠ¨æ€æ›´æ–°sanicæœåŠ¡ä¸­çš„æ•°æ®)
    - [ä»»åŠ¡ç›®æ ‡ï¼š](#ä»»åŠ¡ç›®æ ‡)
    - [ä¸»æ–‡ä»¶ï¼š](#ä¸»æ–‡ä»¶)
    - [å·¥å…·æ–‡ä»¶ï¼š](#å·¥å…·æ–‡ä»¶)
    - [æ•°æ®å­˜å…¥redisçš„æ–‡ä»¶ï¼š](#æ•°æ®å­˜å…¥redisçš„æ–‡ä»¶)
    - [æ¸…ç©ºRedisæ•°æ®(å¯é€‰)ï¼š](#æ¸…ç©ºredisæ•°æ®å¯é€‰)
    - [æ–‡ä»¶è¿è¡Œé¡ºåºï¼š](#æ–‡ä»¶è¿è¡Œé¡ºåº)
    - [ä»£ç è§£é‡Šï¼š](#ä»£ç è§£é‡Š)
  - [Sanicä½¿ç”¨å…¬å…±å‰ç¼€(Blueprint):](#sanicä½¿ç”¨å…¬å…±å‰ç¼€blueprint)

## Sanicçš„å®‰è£…

pip å®‰è£…sanicçš„æŒ‡ä»¤å¦‚ä¸‹ï¼š<br>

```bash
pip install sanic
```

## ç®€å•sanicåº”ç”¨ç¤ºä¾‹ï¼š

ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä»‹ç»ï¼Œè¯´æ˜å¦‚ä½•ä½¿ç”¨ Sanic æ„å»ºä¸€ä¸ªåŸºæœ¬çš„ Web åº”ç”¨ï¼š<br>

1. åˆ›å»ºä¸€ä¸ª Sanic åº”ç”¨:

åˆ›å»ºä¸€ä¸ª Python æ–‡ä»¶ï¼Œä¾‹å¦‚ `sanic_server.py`(æ–‡ä»¶åå¯ä»¥éšæ„å®šä¹‰)ï¼Œå¹¶å¯¼å…¥ Sanicï¼š<br>

```python
from sanic import Sanic
from sanic import response

app = Sanic(__name__)
```

2. æ·»åŠ è·¯ç”±å’Œå¤„ç†å‡½æ•°:

åœ¨ä½ çš„åº”ç”¨ä¸­ï¼Œä½ å¯ä»¥å®šä¹‰ä¸åŒçš„è·¯ç”±ï¼Œå¹¶ä¸ºæ¯ä¸ªè·¯ç”±å®šä¹‰å¤„ç†å‡½æ•°ã€‚ä¾‹å¦‚ï¼š<br>

```python
@app.route("/")
async def index(request):
    return response.text("Hello, Sanic!")

@app.route("/user/<name>")
async def greet_user(request, name):
    return response.text(f"Hello, {name}!")
```

è¿™é‡Œï¼Œ`@app.route` è£…é¥°å™¨ç”¨äºæŒ‡å®šè·¯ç”±ï¼Œæ¥å— HTTP è¯·æ±‚ï¼Œå¹¶è°ƒç”¨ç›¸åº”çš„å¤„ç†å‡½æ•°ã€‚<br>

3. å¯åŠ¨ Sanic åº”ç”¨:

åœ¨åº”ç”¨çš„æœ€åï¼Œæ·»åŠ ä»¥ä¸‹ä»£ç ä»¥è¿è¡Œ Sanic æœåŠ¡å™¨ï¼š<br>

```python
if __name__ == "__main__":
    app.run(host="0.0.0.0", port=8000)
```

4. è¿è¡Œåº”ç”¨:

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œä½ çš„åº”ç”¨ï¼š<br>

```bash
python sanic_server.py
```

ç°åœ¨ï¼Œä½ çš„ Sanic åº”ç”¨åº”è¯¥å·²ç»åœ¨æœ¬åœ°è¿è¡Œï¼Œå¹¶ç›‘å¬åœ¨ç«¯å£ 8000 ä¸Šã€‚<br>

è¿™åªæ˜¯ Sanic çš„åŸºæœ¬ç”¨æ³•ï¼Œå®ƒè¿˜æä¾›äº†è®¸å¤šå…¶ä»–åŠŸèƒ½ï¼Œå¦‚ä¸­é—´ä»¶æ”¯æŒã€å¼‚æ­¥è¯·æ±‚å¤„ç†ã€WebSocket æ”¯æŒç­‰ç­‰ï¼Œä»¥æ»¡è¶³ä¸åŒç±»å‹çš„ Web åº”ç”¨éœ€æ±‚ã€‚ä½ å¯ä»¥æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ä»¥æ·±å…¥äº†è§£æ›´å¤šä¿¡æ¯ï¼šhttps://sanicframework.org/<br>

## ä½¿ç”¨postmanæµ‹è¯•sanicå¯åŠ¨çš„æœåŠ¡ï¼š

Postman æ˜¯ä¸€ç§æµè¡Œçš„åº”ç”¨ç¨‹åºï¼Œç”¨äºæµ‹è¯•å’Œè°ƒè¯•ç½‘ç»œ APIï¼ˆåº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼‰ã€‚å®ƒæä¾›äº†ä¸€ä¸ªç”¨æˆ·å‹å¥½çš„ç•Œé¢ï¼Œå…è®¸å¼€å‘äººå‘˜è½»æ¾åœ°åˆ›å»ºã€å‘é€å’Œæ¥æ”¶ HTTP è¯·æ±‚ï¼Œä»¥æµ‹è¯• API çš„å„ç§ç«¯ç‚¹å’ŒåŠŸèƒ½ã€‚Postman è¿˜å…è®¸ä½ ç»„ç»‡è¯·æ±‚ã€ä¿å­˜å’Œåˆ†äº«æµ‹è¯•é›†åˆï¼Œä»¥åŠè‡ªåŠ¨åŒ– API æµ‹è¯•å·¥ä½œæµç¨‹ã€‚å®ƒå¯ç”¨äºå¤šç§ç”¨é€”ï¼ŒåŒ…æ‹¬å•å…ƒæµ‹è¯•ã€ç«¯åˆ°ç«¯æµ‹è¯•ã€æ€§èƒ½æµ‹è¯•å’Œæ–‡æ¡£ç¼–åˆ¶ç­‰ã€‚<br>

å·¥ä½œä¸­ç»å¸¸ä½¿ç”¨ Postman æµ‹è¯• Sanic ç”¨äºæ„å»º Web åº”ç”¨ç¨‹åºå’Œ APIã€‚ä½¿ç”¨ Postman è¿›è¡Œå•ä¸ªæµ‹è¯•ï¼Œæˆ–è€…ä½¿ç”¨ Postman çš„è‡ªåŠ¨åŒ–åŠŸèƒ½æ¥åˆ›å»º API æ–‡æ¡£å’Œæµ‹è¯•é›†åˆã€‚è¿™æœ‰åŠ©äºç¡®ä¿ API çš„è´¨é‡å’Œæ€§èƒ½ã€‚<br>

Postman ä¸»ç•Œé¢ä»‹ç»å¦‚ä¸‹ï¼š<br>

![Postmanä¸»ç•Œé¢](./postmanä¸»ç•Œé¢æ ‡è¯†.png)

ğŸ³ğŸ³ğŸ³ä¸‹é¢æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹ä»£ç (`sanic_server.py`)ä»‹ç»å¦‚ä½•ä½¿ç”¨ Postman æµ‹è¯•æˆ‘ä»¬æ‰€å¯åŠ¨çš„ Sanic æœåŠ¡æ•ˆæœå¦‚ä½•ã€‚<br>

```python
# sanic_server.py
from sanic import Sanic
from sanic import response

app = Sanic(__name__)

@app.route("/")
async def index(request):
    """è¯¥è·¯ç”±ä¸ºGETæ–¹æ³•
    postmané€‰æ‹©GETæ–¹æ³•ï¼Œåœ¨urlå¡«å…¥http://8.140.203.xxx:8848/çš„ç½‘å€ï¼Œç‚¹å‡»Sendå³å¯æŸ¥çœ‹æ•ˆæœã€‚(ä¸éœ€è¦é¢å¤–é€‰æ‹©å‚æ•°ã€‚)
    """
    return response.text("Hello, Sanic!")

@app.route("/user/<name>")
async def greet_user(request, name):
    """è¯¥è·¯ç”±ä¸ºGETæ–¹æ³•
    è¿™ä¸ªè·¯ç”±åŒ…å«äº†ä¸€ä¸ªåŠ¨æ€å‚æ•° `<name>`ï¼Œè¿™ä¸ªå‚æ•°å¯ä»¥åœ¨ URL ä¸­æ¥å—ç”¨æˆ·æä¾›çš„å€¼ã€‚ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·è®¿é—®ç±»ä¼¼ http://8.140.203.xxx:8848/user/John çš„URLæ—¶ï¼Œä¼šæ‰§è¡Œ `greet_user` å‡½æ•°ï¼Œå¹¶å°† `name` å‚æ•°è®¾ç½®ä¸º "John"ï¼Œç„¶åè¿”å› "Hello, John!" çš„æ–‡æœ¬å“åº”ã€‚
    """
    return response.text(f"Hello, {name}!")

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=8000)
```

è¦ä½¿ç”¨Postmanæµ‹è¯•ä¸Šè¿°Sanicåº”ç”¨ç¨‹åºï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š<br>

1. å¯åŠ¨Sanicåº”ç”¨ç¨‹åºï¼š
   
åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œä½ çš„Pythonè„šæœ¬ï¼Œä»¥å¯åŠ¨Sanicåº”ç”¨ç¨‹åºã€‚è¿™å°†ä½¿åº”ç”¨ç¨‹åºåœ¨æœ¬åœ°è¿è¡Œå¹¶ç›‘å¬ç«¯å£8000ã€‚<br>

```bash
python sanic_server.py
```

2. æ‰“å¼€Postmanï¼š
   
æ‰“å¼€Postmanåº”ç”¨ç¨‹åºæˆ–è®¿é—®Postmanç½‘ç«™ã€‚<br>

3. åˆ›å»ºä¸€ä¸ªæ–°çš„è¯·æ±‚ï¼š

åœ¨Postmanä¸»ç•Œé¢ä¸­ï¼Œç‚¹å‡»"New"ï¼ˆæ–°å»ºï¼‰æŒ‰é’®ï¼Œç„¶åé€‰æ‹©HTTPæ–¹æ³•ã€‚<br>

4. é…ç½®è¯·æ±‚ï¼š
   
- åœ¨è¯·æ±‚çš„"Request Type"ï¼ˆè¯·æ±‚ç±»å‹ï¼‰ä¸‹æ‹‰èœå•ä¸­ï¼Œé€‰æ‹©HTTPæ–¹æ³•ï¼Œå¦‚GETã€POSTç­‰ã€‚ä¸Šè¿°ä»£ç æˆ‘åªä½¿ç”¨äº†GETæ–¹æ³•çš„è·¯ç”±ï¼Œæ‰€ä»¥è¯·æ±‚ç±»å‹è®¾ç½®ä¸ºGETã€‚

- åœ¨"Enter request URL"ï¼ˆè¾“å…¥è¯·æ±‚URLï¼‰å­—æ®µä¸­ï¼Œè¾“å…¥Sanicåº”ç”¨ç¨‹åºçš„URLã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒåº”è¯¥æ˜¯`http://localhost:8000`ï¼Œä½†å¦‚æœä½ çš„åº”ç”¨ç¨‹åºåœ¨ä¸åŒçš„ä¸»æœºæˆ–ç«¯å£ä¸Šè¿è¡Œï¼Œè¯·ç›¸åº”åœ°æ›´æ”¹URLã€‚

- å¦‚æœä½ è¦æµ‹è¯•å…·æœ‰å‚æ•°çš„è·¯ç”±ï¼Œå¦‚`/user/<name>`ï¼Œåˆ™éœ€è¦åœ¨URLä¸­åŒ…å«ç›¸åº”çš„å‚æ•°ï¼Œä¾‹å¦‚`http://localhost:8000/user/John`ã€‚

- åœ¨"Headers"ï¼ˆæ ‡å¤´ï¼‰éƒ¨åˆ†ï¼Œä½ å¯ä»¥æ·»åŠ ä»»ä½•å¿…è¦çš„æ ‡å¤´ã€‚**é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸éœ€è¦æ·»åŠ ä»»ä½•ç‰¹æ®Šæ ‡å¤´ã€‚**ğŸ˜€ğŸ˜€ğŸ˜€

- å¦‚æœä½ ä½¿ç”¨POSTè¯·æ±‚ï¼Œä½ å¯ä»¥åœ¨"Body"ï¼ˆæ­£æ–‡ï¼‰éƒ¨åˆ†è®¾ç½®è¯·æ±‚æ­£æ–‡ã€‚æ ¹æ®ä½ çš„åº”ç”¨ç¨‹åºï¼Œå¯èƒ½éœ€è¦åœ¨æ­£æ–‡ä¸­åŒ…å«JSONæ•°æ®æˆ–è¡¨å•æ•°æ®ã€‚

5. å‘é€è¯·æ±‚ï¼š

ç‚¹å‡»"Send"ï¼ˆå‘é€ï¼‰æŒ‰é’®ä»¥å‘é€è¯·æ±‚åˆ°Sanicåº”ç”¨ç¨‹åºã€‚<br>

6. æŸ¥çœ‹å“åº”ï¼š

Postmanå°†æ˜¾ç¤ºä»Sanicåº”ç”¨ç¨‹åºæ¥æ”¶åˆ°çš„å“åº”ã€‚ä½ åº”è¯¥èƒ½å¤Ÿçœ‹åˆ°ä½ çš„åº”ç”¨ç¨‹åºè¿”å›çš„æ•°æ®æˆ–æ¶ˆæ¯ã€‚<br>

é€šè¿‡æŒ‰ç…§ä»¥ä¸Šæ­¥éª¤é…ç½®å’Œå‘é€è¯·æ±‚ï¼Œä½ å¯ä»¥ä½¿ç”¨Postmanæµ‹è¯•ä½ çš„Sanicåº”ç”¨ç¨‹åºçš„ä¸åŒè·¯ç”±å’ŒåŠŸèƒ½ã€‚ç¡®ä¿ä½ çš„Sanicåº”ç”¨ç¨‹åºæ­£åœ¨è¿è¡Œï¼Œå¹¶ä¸”Postmané…ç½®æ­£ç¡®ä»¥ä¾¿ä¸å…¶é€šä¿¡ã€‚<br>


## GETå’ŒPOSTæ–¹æ³•ï¼š

### GET æ–¹æ³•è¿›é˜¶ï¼š

ç¬”è€…åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­å®šä¹‰çš„ä¸¤ä¸ªè·¯ç”±é»˜è®¤éƒ½æ˜¯ä½¿ç”¨ GET æ–¹æ³•ã€‚GET æ–¹æ³•çš„ä½¿ç”¨è¾ƒä¸ºç®€å•ï¼Œä½†åœ¨ä½¿ç”¨ GET æ–¹æ³•æ—¶ä¾æ—§è¦æ³¨æ„ä¸€äº›å†…å®¹ï¼š<br>

GET æ–¹æ³•ä¸ä¸€å®šéœ€è¦ä¼ é€’å‚æ•°ï¼Œå› ä¸ºå®ƒå¯ä»¥åœ¨URLä¸­åŒ…å«æŸ¥è¯¢å­—ç¬¦ä¸²ï¼ˆquery stringï¼‰æ¥ä¼ é€’å‚æ•°ã€‚æŸ¥è¯¢å­—ç¬¦ä¸²æ˜¯URLä¸­çš„ä¸€éƒ¨åˆ†ï¼Œé€šå¸¸è·Ÿåœ¨é—®å·ï¼ˆ?ï¼‰ä¹‹åï¼Œå‚æ•°ä¹‹é—´ç”¨â€œ&â€ç¬¦å·åˆ†éš”ã€‚ä¾‹å¦‚ï¼š<br>

```log
http://example.com/resource?param1=value1&param2=value2
```

åœ¨è¿™ä¸ªURLä¸­ï¼Œ`param1` å’Œ `param2` æ˜¯ä¸¤ä¸ªGETè¯·æ±‚çš„å‚æ•°ï¼Œå®ƒä»¬çš„å€¼åˆ†åˆ«æ˜¯`value1`å’Œ`value2`ã€‚<br>

åœ¨Sanicä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨`request.args`æ¥è·å–URLä¸­çš„æŸ¥è¯¢å‚æ•°ã€‚ä¾‹å¦‚ï¼š<br>

```python
from sanic import Sanic
from sanic import response

app = Sanic(__name__)

@app.route("/example")
async def example(request):
    param1 = request.args.get("param1")
    param2 = request.args.get("param2")
    
    return response.text(f"param1: {param1}, param2: {param2}")

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=8000)
```

å½“ä½ è®¿é—® `http://localhost:8000/example?param1=value1&param2=value2` æ—¶ï¼ŒSanic å°†ä»æŸ¥è¯¢å­—ç¬¦ä¸²ä¸­æå–å‚æ•°å€¼ï¼Œå¹¶å°†å®ƒä»¬ä¼ é€’ç»™è·¯ç”±å¤„ç†å‡½æ•°ã€‚ç„¶åï¼Œä½ å¯ä»¥åœ¨å‡½æ•°å†…éƒ¨ä½¿ç”¨è¿™äº›å‚æ•°æ¥æ‰§è¡Œé€»è¾‘æ“ä½œã€‚<br>

æ€»ç»“ä¸€ä¸‹ï¼ŒGET æ–¹æ³•é€šå¸¸ç”¨äºä»æœåŠ¡å™¨è·å–æ•°æ®ï¼Œå‚æ•°å¯ä»¥é€šè¿‡æŸ¥è¯¢å­—ç¬¦ä¸²ä¼ é€’ç»™æœåŠ¡å™¨ï¼Œç„¶åæœåŠ¡å™¨å¯ä»¥è§£ææŸ¥è¯¢å­—ç¬¦ä¸²æ¥è·å–è¿™äº›å‚æ•°çš„å€¼ã€‚ Sanic çš„ `request.args` å¯ä»¥å¸®åŠ©ä½ åœ¨è·¯ç”±å¤„ç†å‡½æ•°ä¸­æ–¹ä¾¿åœ°è·å–è¿™äº›å‚æ•°ã€‚<br>

### POST æ–¹æ³•ï¼š

å¦‚æœä½ æƒ³è¦å®šä¹‰ä¸€ä¸ªä½¿ç”¨ POST æ–¹æ³•çš„è·¯ç”±ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨ `methods` å‚æ•°æ¥æŒ‡å®šè¯·æ±‚æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br>

```python
from sanic import Sanic
from sanic import response
import jieba

app = Sanic(__name__)

# ä½¿ç”¨ GET æ–¹æ³•çš„è·¯ç”±
@app.route("/")
async def index(request):
    return response.text("Hello, Sanic!")

@app.route("/segment", methods=["POST"])
async def segment(request):
    """åˆ†è¯API"""
    text = request.json.get("text")
    if not text:
        return response.json({"error": "Missing 'text' parameter"}, status=400)

    result = jieba.lcut(text)
    return response.json({"åˆ†è¯ç»“æœä¸ºï¼š": result})

@app.route("/ans", methods=["POST"])
async def test(request):
    # è·å–ç”¨æˆ·æ•°æ®
    text = request.form.get("usr_input")
    if not text:
        return response.json({"error": "Missing 'usr_input' parameter"}, status=400)

    result = jieba.lcut(text)
    return response.json({"ç”¨æˆ·æ•°æ®åˆ†è¯ç»“æœä¸ºï¼š": result})

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=8848)
```

ğŸš€ğŸš€ğŸš€æ¥ä¸‹æ¥ï¼Œæˆ‘è®²è§£ä¸‹ä¸Šè¿°ä»£ç ä¸­è·¯ç”±"/segment"å’Œ"/ans"çš„ä¸åŒï¼Œä»¥åŠåº”è¯¥å¦‚ä½•ç”¨postmanæµ‹è¯•ï¼š<br>

1. **è·¯ç”±è·¯å¾„**ï¼š

- "/segment"è·¯ç”±ç”¨äºå¤„ç†POSTè¯·æ±‚ï¼Œå…¶è·¯å¾„ä¸º"/segment"ã€‚

- "/ans"è·¯ç”±ä¹Ÿç”¨äºå¤„ç†POSTè¯·æ±‚ï¼Œå…¶è·¯å¾„ä¸º"/ans"ã€‚

2. **è¯·æ±‚å‚æ•°çš„è·å–æ–¹å¼**ï¼š

- "/segment"è·¯ç”±ä½¿ç”¨`request.json.get("text")`æ¥è·å–è¯·æ±‚ä¸­çš„**JSONæ•°æ®**ï¼Œå¹¶æœŸæœ›æ•°æ®åŒ…å«ä¸€ä¸ªåä¸º"text"çš„å­—æ®µã€‚

- "/ans"è·¯ç”±ä½¿ç”¨`request.form.get("usr_input")`æ¥è·å–**è¡¨å•æ•°æ®**ï¼Œå¹¶æœŸæœ›æ•°æ®åŒ…å«ä¸€ä¸ªåä¸º"usr_input"çš„å­—æ®µã€‚

3. **å“åº”**ï¼š

- "/segment"è·¯ç”±è¿”å›ä¸€ä¸ªJSONå“åº”ï¼Œå…¶ä¸­åŒ…å«åˆ†è¯çš„ç»“æœã€‚

- "/ans"è·¯ç”±ä¹Ÿè¿”å›ä¸€ä¸ªJSONå“åº”ï¼Œå…¶ä¸­åŒ…å«åˆ†è¯çš„ç»“æœã€‚

### POST æ–¹æ³•è·¯ç”±çš„æµ‹è¯•ï¼š

è¦ä½¿ç”¨Postmanæµ‹è¯•"/segment"å’Œ"/ans"è¿™ä¸¤ä¸ªè·¯ç”±ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œï¼š<br>

1. æ‰“å¼€Postmanåº”ç”¨ç¨‹åºã€‚

2. åˆ›å»ºä¸€ä¸ªæ–°çš„è¯·æ±‚ã€‚

3. åœ¨è¯·æ±‚çš„URLæ ä¸­è¾“å…¥ä½ çš„åº”ç”¨ç¨‹åºçš„åœ°å€å’Œç«¯å£ï¼Œä¾‹å¦‚ï¼šhttp://localhost:8848ã€‚

4. é€‰æ‹©HTTPæ–¹æ³•ä¸º"POST"ã€‚

5. å¯¹äº"/segment"è·¯ç”±ï¼Œåˆ‡æ¢åˆ°"Body"é€‰é¡¹å¡ï¼Œé€‰æ‹©"raw"ï¼Œç„¶ååœ¨æ–‡æœ¬æ¡†ä¸­è¾“å…¥JSONæ•°æ®(**"raw"é€‰é¡¹çš„æœ€åä¸€ä½å¸¦ç®­å¤´ä½ç½®é€‰JSON**)ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```json
{
    "text": "è¿™æ˜¯ä¸€æ®µæ–‡æœ¬ï¼Œéœ€è¦è¿›è¡Œåˆ†è¯ã€‚"
}
```

6. ç‚¹å‡»å‘é€æŒ‰é’®ï¼Œä½ å°†è·å¾—åˆ†è¯ç»“æœçš„JSONå“åº”ã€‚

7. å¯¹äº"/ans"è·¯ç”±ï¼Œåˆ‡æ¢åˆ°"Body"é€‰é¡¹å¡ï¼Œé€‰æ‹©"x-www-form-urlencoded"ï¼Œç„¶ååœ¨"Key"ä¸­æ·»åŠ ä¸€ä¸ªåä¸º"usr_input"çš„å­—æ®µï¼Œå¹¶åœ¨Valueä¸­è¾“å…¥æ–‡æœ¬ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```log
usr_input: è¿™æ˜¯ä¸€æ®µç”¨æˆ·æ•°æ®ï¼Œéœ€è¦è¿›è¡Œåˆ†è¯ã€‚
```

8. ç‚¹å‡»å‘é€æŒ‰é’®ï¼Œä½ å°†è·å¾—ç”¨æˆ·æ•°æ®åˆ†è¯ç»“æœçš„JSONå“åº”ã€‚

è¿™æ ·ï¼Œä½ å¯ä»¥ä½¿ç”¨Postmanæµ‹è¯•è¿™ä¸¤ä¸ªä¸åŒçš„è·¯ç”±å¹¶æŸ¥çœ‹å®ƒä»¬çš„ä¸åŒåŠŸèƒ½ã€‚ä¸€ä¸ªè·¯ç”±æœŸæœ›JSONæ•°æ®ï¼Œè€Œå¦ä¸€ä¸ªæœŸæœ›è¡¨å•æ•°æ®ã€‚<br>

### Postman ä¸­ Body é€‰é¡¹çš„å«ä¹‰ä¸é€‰æ‹©ï¼š
åœ¨Postmanä¸­ï¼ŒBodyé€‰é¡¹ç”¨äºæŒ‡å®šè¯·æ±‚çš„æ¶ˆæ¯ä½“ï¼ˆpayloadï¼‰å†…å®¹ã€‚ä»¥ä¸‹æ˜¯åœ¨Bodyé€‰é¡¹ä¸­å¸¸è§çš„å‡ ä¸ªé€‰é¡¹åŠå…¶å«ä¹‰ï¼š<br>

1. **none:** è¿™è¡¨ç¤ºè¯·æ±‚ä¸åŒ…å«æ¶ˆæ¯ä½“ã€‚é€‰æ‹©æ­¤é€‰é¡¹æ—¶ï¼Œè¯·æ±‚é€šå¸¸æ˜¯GETæˆ–DELETEç­‰ä¸éœ€è¦å‘é€æ•°æ®çš„HTTPæ–¹æ³•ã€‚

2. **form-Data:** å½“ä½¿ç”¨è¯¥é€‰é¡¹æ—¶ï¼Œè¯·æ±‚çš„æ¶ˆæ¯ä½“å°†è¢«æ ¼å¼åŒ–ä¸ºmultipart/form-dataæ ¼å¼ã€‚è¿™é€šå¸¸ç”¨äºä¸Šä¼ æ–‡ä»¶æˆ–é€šè¿‡è¡¨å•æäº¤æ•°æ®ã€‚

3. **x-www-form-urlencoded:** é€‰æ‹©æ­¤é€‰é¡¹å°†ä»¥URLç¼–ç å½¢å¼å‘é€è¯·æ±‚çš„æ•°æ®ã€‚ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥è¿™ç§æ ¼å¼é€šå¸¸ç”¨äºHTMLè¡¨å•æäº¤ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ã€‚

4. **raw:** å½“é€‰æ‹©æ­¤é€‰é¡¹æ—¶ï¼Œä½ å¯ä»¥æ‰‹åŠ¨ç¼–è¾‘è¯·æ±‚çš„æ¶ˆæ¯ä½“å†…å®¹ã€‚ä½ å¯ä»¥é€‰æ‹©ä¸åŒçš„æ ¼å¼ï¼Œä¾‹å¦‚æ–‡æœ¬ï¼ˆçº¯æ–‡æœ¬ï¼‰ã€JSONï¼ˆåº”ç”¨/JSONï¼‰ã€XMLï¼ˆapplication/xmlï¼‰ç­‰ã€‚

5. **binary:** é€‰æ‹©æ­¤é€‰é¡¹ä»¥ä¸Šä¼ äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ä½ å¯ä»¥é€‰æ‹©å°†æ–‡ä»¶ç›´æ¥ä»ç£ç›˜ä¸Šè½½ï¼Œæˆ–è€…ä½¿ç”¨ä»£ç æˆ–å…¶ä»–æ–¹å¼ç”ŸæˆäºŒè¿›åˆ¶æ•°æ®ã€‚

6. **graphQL:** å¦‚æœä½ æ­£åœ¨ä½¿ç”¨GraphQL APIï¼Œåˆ™å¯ä»¥é€‰æ‹©æ­¤é€‰é¡¹ï¼Œå¹¶åœ¨è¯·æ±‚çš„æ¶ˆæ¯ä½“ä¸­ç¼–å†™GraphQLæŸ¥è¯¢ã€‚

7. **file:** è¿™ä¸ªé€‰é¡¹å…è®¸ä½ å°†æ–‡ä»¶ç›´æ¥ä½œä¸ºè¯·æ±‚çš„æ¶ˆæ¯ä½“ã€‚ä½ å¯ä»¥é€‰æ‹©ä»ç£ç›˜ä¸Šè½½æ–‡ä»¶ï¼Œæˆ–è€…ä»å·²å‘é€çš„è¯·æ±‚ä¸­é€‰æ‹©æ–‡ä»¶ã€‚

é€‰æ‹©å“ªä¸ªé€‰é¡¹å–å†³äºä½ è¦å‘é€çš„æ•°æ®ç±»å‹å’Œè¯·æ±‚çš„è¦æ±‚ã€‚å¦‚æœä½ è¦å‘é€è¡¨å•æ•°æ®ï¼Œä½ å¯ä»¥é€‰æ‹©Form-Dataæˆ–x-www-form-urlencodedã€‚å¦‚æœä½ è¦å‘é€JSONæ•°æ®ï¼Œå¯ä»¥é€‰æ‹©Rawå¹¶å°†Content-Typeè®¾ç½®ä¸ºapplication/jsonã€‚å¦‚æœä½ è¦ä¸Šä¼ æ–‡ä»¶ï¼Œä½ å¯ä»¥é€‰æ‹©Form-Dataæˆ–Binaryï¼Œå…·ä½“å–å†³äºä½ çš„éœ€æ±‚ã€‚<br>

## request å¯¹è±¡ï¼š

**request**åŒ…å«äº†å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰å‘è¿‡æ¥çš„HTTPè¯·æ±‚çš„å„ç±»æ•°æ®ã€‚requestä¸éœ€è¦æ˜¾ç¤ºå¯¼å…¥ï¼ŒSanicå†…éƒ¨å«æœ‰ã€‚request åŒ…å«ä»¥ä¸‹å±æ€§ï¼š<br>

| å±æ€§   | ä½¿ç”¨æ–¹å¼        | æ„ä¹‰                                        |
|--------|-----------------|---------------------------------------------|
| json   | request.json | å½“å®¢æˆ·ç«¯POSTæ¥çš„æ•°æ®æ˜¯jsonæ ¼å¼æ—¶ï¼Œè®¿é—®jsonæ•°æ® |
| args   | request.args | æŸ¥è¯¢å­—ç¬¦ä¸²å˜é‡ï¼Œå³URLä¸­é—®å·?åé¢çš„éƒ¨åˆ†        |
| files  | å­—å…¸            | æ‹¥æœ‰nameã€bodyå’Œtypeçš„æ–‡ä»¶å¯¹è±¡çš„å­—å…¸           |
| form   | è¡¨å•            | ä»¥POSTæ–¹å¼ä¼ é€’çš„formå˜é‡                     |
| body   | å­—èŠ‚ä¸²          | POSTçš„åŸå§‹æ•°æ®                               |  


## response å¯¹è±¡ï¼š

`from sanic import response` æ˜¯ Sanic æ¡†æ¶æä¾›çš„ä¸€ä¸ªæ¨¡å—ï¼Œå®ƒåŒ…å«äº†ä¸€äº›ç”¨äºæ„å»º HTTP å“åº”çš„å®ç”¨å‡½æ•°ã€‚è¿™ä¸ªæ¨¡å—ä½¿å¾—è¿”å›ä¸åŒç±»å‹çš„å“åº”å˜å¾—æ›´åŠ ç®€å•ã€‚å…¶ä¸­ï¼Œ`response.json` æ˜¯å…¶ä¸­ä¸€ä¸ªéå¸¸å¸¸ç”¨çš„å‡½æ•°ï¼Œå®ƒç”¨äºæ„å»º JSON æ ¼å¼çš„ HTTP å“åº”ã€‚<br>

ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§ç”¨æ³•å’Œç¤ºä¾‹ï¼š<br>

1. è¿”å› JSON å“åº”ï¼š

ä½¿ç”¨ `response.json` å‡½æ•°ï¼Œä½ å¯ä»¥å°† Python å­—å…¸æˆ–å¯¹è±¡è½¬æ¢ä¸º JSON æ ¼å¼çš„å“åº”å¹¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ç¤ºä¾‹ï¼š<br>

```python
from sanic import Sanic
from sanic import response

app = Sanic(__name__)

@app.route("/json")
async def json_example(request):
    data = {"message": "Hello, Sanic!"}
    return response.json(data)
```

è¿™å°†è¿”å›ä¸€ä¸ª JSON å“åº”ï¼Œå…¶å†…å®¹ä¸º `{"message": "Hello, Sanic!"}`ã€‚<br>

2. è¿”å›æ–‡æœ¬å“åº”ï¼š

ä½¿ç”¨ `response.text` å‡½æ•°ï¼Œä½ å¯ä»¥è¿”å›æ™®é€šæ–‡æœ¬å“åº”ã€‚ç¤ºä¾‹ï¼š<br>

```python
@app.route("/text")
async def text_example(request):
    return response.text("This is a text response.")
```

è¿™å°†è¿”å›ä¸€ä¸ªåŒ…å«æŒ‡å®šæ–‡æœ¬çš„å“åº”ã€‚<br>

3. è¿”å› HTML å“åº”ï¼š

ä½¿ç”¨ `response.html` å‡½æ•°ï¼Œä½ å¯ä»¥è¿”å›åŒ…å« HTML å†…å®¹çš„å“åº”ã€‚ç¤ºä¾‹ï¼š<br>

```python
@app.route("/html")
async def html_example(request):
    html_content = "<html><body><h1>Hello, Sanic!</h1></body></html>"
    return response.html(html_content)
```

è¿™å°†è¿”å›ä¸€ä¸ªåŒ…å«æŒ‡å®š HTML å†…å®¹çš„å“åº”ã€‚<br>

æ€»ä¹‹ï¼Œ`response` æ¨¡å—æä¾›äº†ä¸€äº›æ–¹ä¾¿çš„å‡½æ•°ï¼Œç”¨äºæ„å»ºä¸åŒç±»å‹çš„ HTTP å“åº”ï¼ŒåŒ…æ‹¬ JSONã€æ–‡æœ¬ã€HTML ç­‰ã€‚ä½ å¯ä»¥æ ¹æ®ä½ çš„éœ€æ±‚ä½¿ç”¨è¿™äº›å‡½æ•°æ¥æ„å»ºå’Œè¿”å›é€‚å½“ç±»å‹çš„å“åº”ç»™å®¢æˆ·ç«¯ã€‚<br>

## ä½¿ç”¨ Postman åŠ¨æ€æ›´æ–°SanicæœåŠ¡ä¸­ç±»å±æ€§ï¼š

å·¥ä½œä¸­ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°éœ€è¦åœ¨ç¨‹åºå¯åŠ¨ååŠ¨æ€æ›´æ–°æŸäº›å˜é‡çš„æƒ…å†µï¼Œæ¥ä¸‹æ¥æˆ‘å°†ç»™ä½ å…·ä½“çš„ä¾‹å­ï¼š<br>

### åœ¨ä¸»æ–‡ä»¶ä¸­å®šä¹‰è·¯ç”±ï¼š

```python
# main.py
from sanic import Sanic
from sanic import response
from nlp_entry import create_pipelene
from code_utils import Dimension_analy

app = Sanic("my_app")

@app.route("/ans", methods=["POST"])
async def answer(request):
    # è·å–ç”¨æˆ·æ•°æ®
    text = request.form.get("usr_input")
    processed_data = create_pipelene(text)
    return response.json(processed_data)

@app.route("/refresh")
async def refresh_metadata(request):
    Dimension_analy.modify_class_variable()
    return response.json({"message":"Dimension_analyçš„ç±»å±æ€§æ›´æ–°æˆåŠŸ"})

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=8848)
```

### é™„å±æ–‡ä»¶ä¸­å®šä¹‰ç”¨æˆ·è¾“å‡ºçš„å¤„ç†æµç¨‹ï¼š

```python
# nlp_entry.py

from code_utils import Dimension_analy

def create_pipelene(usr_input):
    tmp_dimension = Dimension_analy()
    res_dim = tmp_dimension.handle(usr_input)
    return res_dim
```

### å·¥å…·å‹å‡½æ•°ä¸­å®šä¹‰æ–‡æœ¬å¤„ç†ã€å˜é‡æ›´æ–°ç»†èŠ‚ï¼š

```python
# code_utils
class Dimension_analy:
    """è¿›è¡Œç»´åº¦åˆ†æ
    """
    # å®šä¹‰ç±»å±æ€§
    dimension_data = 0

    def __init__(self):
        pass

    def handle(self, usr_input):
        """æµ‹è¯•ç±»å±æ€§æ˜¯å¦å˜åŒ–ï¼Œæ˜¯å¦æ”¯æŒåŠ¨æ€æ›´æ–°
        """
        res_dict = {"ç”¨æˆ·æ•°æ®":usr_input,
                    "ç»´åº¦æ•°æ®ä¸º:": self.dimension_data} # è°ƒç”¨ç±»å±æ€§
        return res_dict

    @classmethod
    def modify_class_variable(cls):
        """æ¯æ¬¡è°ƒç”¨æ›´æ–°ä¸€æ¬¡ç±»å±æ€§
        """
        cls.dimension_data += 1
```

### è¿è¡Œæ–¹å¼ï¼š

1. å¯åŠ¨`main.py`æ–‡ä»¶ï¼›

2. Postmané€‰æ‹©POSTæ–¹æ³•ï¼Œurlè¾“å…¥http://8.140.203.xxx:8848/ansï¼›

3. "Body"çš„"x-www-form-urlencoded"é€‰é¡¹ä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š

Key|Value|Description
---|---|---
usr_input | é»„é‡‘æ¿å—æ”¶ç›Šå¦‚ä½•ï¼Ÿ | Valueä¸­çš„å†…å®¹å¯ä¸ºä»»æ„å­—ç¬¦ä¸²

4. ç‚¹å‡»Sendï¼Œä½ å°†è·å¾—å¦‚ä¸‹JSONå“åº”ï¼š

```json
{
    "ç”¨æˆ·æ•°æ®": "é»„é‡‘æ¿å—æ”¶ç›Šå¦‚ä½•ï¼Ÿ",
    "ç»´åº¦æ•°æ®ä¸º:": 0
}
```

ç”±äºæ²¡æœ‰æ›´æ–°"Dimension_analy"ä¸­"dimension_data"ï¼Œæ‰€ä»¥æ­¤å¤„æ˜¾ç¤ºçš„æ˜¯åŸå§‹å€¼ "dimension_data = 0"ã€‚<br>

ç°åœ¨ï¼Œæˆ‘ä»¬å°è¯•é€šè¿‡æ¥å£ "/refresh" æ›´æ–° "dimension_data" æµ‹è¯•ä¸‹æ•ˆæœï¼š<br>

5. Postmané€‰æ‹©GETæ–¹æ³•ï¼Œurlè¾“å…¥http://8.140.203.xxx:8848/refreshï¼›(ä¸éœ€è¦è¾“å…¥å…¶ä»–å‚æ•°)

6. ç‚¹å‡»Sendï¼Œä½ å°†è·å¾—å¦‚ä¸‹JSONå“åº”ï¼š

```json
{
    "message": "Dimension_analyçš„ç±»å±æ€§æ›´æ–°æˆåŠŸ"
}
```

7. è½¬å›http://8.140.203.xxx:8848/ansæ¥å£ç•Œé¢ï¼Œç‚¹å‡»Sendï¼Œä½ å°†è·å¾—å¦‚ä¸‹JSONå“åº”ï¼š

```json
{
    "ç”¨æˆ·æ•°æ®": "é»„é‡‘æ¿å—æ”¶ç›Šå¦‚ä½•ï¼Ÿ",
    "ç»´åº¦æ•°æ®ä¸º:": 1
}
```

æ•°æ®åŠ¨æ€æ›´æ–°äº†ï¼Œåœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­æ›´æ–°äº†~~~~<br>

8. æˆ‘ä»¬å†æ¬¡è¿è¡Œhttp://8.140.203.xxx:8848/refreshæ¥å£ï¼Œçœ‹ä¸‹"/ans"æ¥å£çš„æ•ˆæœ:

```json
{
    "ç”¨æˆ·æ•°æ®": "é»„é‡‘æ¿å—æ”¶ç›Šå¦‚ä½•ï¼Ÿ",
    "ç»´åº¦æ•°æ®ä¸º:": 2
}
```

æ•°æ®å†æ¬¡æ›´æ–°ï¼ŒåŠ¨æ€æ›´æ–°æ•ˆæœå®ŒæˆğŸª´ğŸª´ğŸª´<br>

ğŸ¥´ğŸ¥´ğŸ¥´æ­¤æ—¶ï¼Œç›´åˆ°ä½ ä¸‹æ¬¡è°ƒç”¨"/refresh"æ¥å£ï¼Œç¨‹åºçš„"Dimension_analy"ä¸­"dimension_data"æ•°æ®å°†ä¿æŒä¸å˜ã€‚<br>

## ä½¿ç”¨Postman+globalåŠ¨æ€æ›´æ–°SanicæœåŠ¡ä¸­çš„æ•°æ®ï¼š

### ä»»åŠ¡ç›®æ ‡ï¼š

1. ç¡®ä¿ç¨‹åºæ­£å¸¸å¯åŠ¨ï¼›
2. å°†æ•°æ®å­˜å…¥ Redis åï¼Œä¸ªäººæ‰§è¡Œä¸€æ¬¡è§£ææ“ä½œï¼Œè·å–å¯¹åº”æ•°æ®ï¼›
3. ç”¨æˆ·æ¯æ¬¡è°ƒç”¨ç¬”è€…çš„æ¥å£ä½¿ç”¨è¯¥æ•°æ®ï¼Œä¸å¿…é‡æ–°ä» Redis è·å–æ•°æ®ï¼Œç›´æ¥ä»ç¼“å­˜ä¸­è·å–æ•°æ®ã€‚

### ä¸»æ–‡ä»¶ï¼š

```python
# main.py
from sanic import Sanic
from sanic import response
from code_utils import my_function
import redis
import pickle

app = Sanic("my_app")

# è¿æ¥åˆ°Redis
redis_conn = redis.Redis(host='localhost', port=6379)

# å…¨å±€å˜é‡ç”¨äºå­˜å‚¨metadata
metadata = None

@app.route("/ans", methods=["POST"])
async def test(request):
    # è·å–ç”¨æˆ·æ•°æ®
    text = request.form.get("usr_input")
    if metadata is not None:
        processed_data = my_function(metadata)
        res_dict = {"ç”¨æˆ·æ•°æ®":text,
                    "redisä¸­æ•°æ®": processed_data}
    else:
        res_dict = {"ç”¨æˆ·æ•°æ®":text,
                    "redisä¸­æ•°æ®": metadata}
    return response.json(res_dict)

@app.route("/refresh")
async def refresh_metadata(request):
    if redis_conn.get('my_data') is not None:
        global metadata
        metadata = pickle.loads(redis_conn.get('my_data'))
        return response.json({"message": "Metadata å·²åˆ·æ–°!"})
    else:
        return response.json({"message": "Metadata è¿˜æœªå†™å…¥redisï¼Œè¯·å…ˆè¿è¡Œ'/data_to_redis'æ¥å£ã€‚"})

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=8848)
```

### å·¥å…·æ–‡ä»¶ï¼š

```python
# code_utils.py
def my_function(data):
    for idx, item in enumerate(data,1):
        item["å‡½æ•°æ·»åŠ å†…å®¹"] = f"å†…å®¹{idx}"
    return data
```

### æ•°æ®å­˜å…¥redisçš„æ–‡ä»¶ï¼š

```python
# metadata_to_redis.py
import redis
import pickle

# è¿æ¥åˆ°Redis
redis_conn = redis.Redis(host='localhost', port=6379)

# å¯æ”¹ä¸ºå…¶ä»–æ•°æ®ï¼Œæ­¤å¤„åªæ˜¯ä¸ºäº†æ¨¡æ‹Ÿæ•°æ®å†™å…¥ã€‚
data = [{'info_1':{'name': 'éº¦å…‹', 'age': 30, 'man': 'true'}}, 
        {'info_2':{'name': 'Juddy', 'age': 27, 'man': 'false'}}]

# å°†æ•°æ®å­˜å…¥Redis
redis_conn.set('my_data', pickle.dumps(data))
```

### æ¸…ç©ºRedisæ•°æ®(å¯é€‰)ï¼š

å¦‚æœä½ åœ¨ä»£ç æµ‹è¯•è¿‡ç¨‹ä¸­æƒ³è¦æ¸…ç©ºRedisï¼Œå¯ä»¥ä½¿ç”¨ä¸‹åˆ—ä»£ç ï¼š<br>

```python
# empty_redis.py
import redis

# è¿æ¥åˆ°Redis
redis_conn = redis.Redis(host='localhost', port=6379)
# æ¸…ç©ºredis
redis_conn.flushall()
```

### æ–‡ä»¶è¿è¡Œé¡ºåºï¼š

1. è¿è¡Œ`metadata_to_redis.py`æ–‡ä»¶ï¼›

2. è°ƒç”¨`/refresh`æ¥å£ï¼›

3. ç”¨æˆ·æ­¤æ—¶å°±å¯å‘`ans`æ¥å£ä¼ å‚ï¼Œè·å–æ•°æ®ï¼›

### ä»£ç è§£é‡Šï¼š

è¯¥ä»£ç ä¸ºç”¨æˆ·æä¾›ä¸¤ä¸ªæ¥å£ï¼š"/ans"ã€"/refresh"ï¼Œå’Œä¸€ä¸ªæ•°æ®å†™å…¥Redisçš„æ–‡ä»¶ã€‚<br>

ä»¥ä¸‹æ˜¯æ¯ä¸ªæ¥å£/æ–‡ä»¶çš„ä½œç”¨ï¼š<br>

1. `metadata_to_redis.py`ï¼š å°†æ•°æ®å­˜å…¥Redisã€‚

2. `/refresh`ï¼šä»Redisä¸­è¯»å–æ•°æ®ï¼Œå¹¶ä¿å­˜åœ¨å…¨å±€å˜é‡`metadata`ä¸­ã€‚

3. `/ans`ï¼šè¿”å›åŒ…å«ç”¨æˆ·æä¾›æ•°æ®å’Œ`metadata`ä¸­çš„æ•°æ®çš„å“åº”ã€‚åœ¨æ­¤æ¥å£ä¸­ï¼Œå®ƒè¿˜è°ƒç”¨`my_function`æ¥å¤„ç†`metadata`æ•°æ®ã€‚


å½“è¿è¡Œ`metadata_to_redis.py`åï¼Œæ•°æ®è¢«å­˜å…¥Redisã€‚ä¹‹åè¿è¡Œ`/refresh`æ¥å£ï¼Œæ•°æ®ä»Redisä¸­è¯»å–å¹¶å­˜å‚¨åˆ°å…¨å±€å˜é‡`metadata`ä¸­ã€‚æ­¤æ—¶ï¼Œå¯¹äºåç»­çš„`/ans`æ¥å£è°ƒç”¨ï¼Œç¨‹åºç›´æ¥ä»å…¨å±€å˜é‡`metadata`ä¸­è¯»å–æ•°æ®ï¼Œè€Œä¸æ˜¯ä»Redisä¸­ã€‚<br>

ç”¨æˆ·æ¯æ¬¡è°ƒç”¨`ans`æ¥å£ä¸ä¼šå†æœ‰ä»Redisè·å–æ•°æ®å¹¶pickleçš„æ—¶é—´ï¼Œå› ä¸ºæ•°æ®å·²ç»è¢«å­˜å‚¨åœ¨å…¨å±€å˜é‡`metadata`ä¸­ï¼Œæ¥å£ç›´æ¥ä»è¿™ä¸ªå˜é‡è·å–æ•°æ®ã€‚<br>

## Sanicä½¿ç”¨å…¬å…±å‰ç¼€(Blueprint):

é€šå¸¸ï¼Œæˆ‘ä»¬åˆ›å»ºçš„SanicæœåŠ¡ä»£ç å¦‚ä¸‹ï¼š<br>

```python
from sanic import Sanic

app = Sanic("HanLP-API")

@app.route("/segment", methods=["POST"])
async def function(request):
    pass

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=8000)
```

ä½†åœ¨è·¯ç”±å‘½åè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½å‡ºç°å¤šä¸ªç›®å½•ä¸‹å‘½åé‡å¤çš„æƒ…å†µï¼Œä¾‹å¦‚ï¼š<br>

```log
.
â”œâ”€â”€ è€å…‹
â”‚   â”œâ”€â”€ ç”·è£…
â”‚   â””â”€â”€ å¥³è£…
â””â”€â”€ é˜¿è¿ªè¾¾æ–¯
    â””â”€â”€ ç”·è£…
    â””â”€â”€ å¥³è£…
```

æ­¤æ—¶ï¼Œæˆ‘ä»¬ä¸ºäº†åŒºåˆ†"è€å…‹"å’Œ"é˜¿è¿ªè¾¾æ–¯"æ——ä¸‹çš„"ç”·è£…"å’Œ"å¥³è£…"ï¼Œéœ€è¦å¯¹å‘½åç©ºé—´è¿›è¡Œéš”ç¦»ï¼Œæˆ‘ä»¬åº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ<br>

æ­£ç¡®ç­”æ¡ˆæ˜¯ä½¿ç”¨Sanicæä¾›çš„è“å›¾(Blueprint)åŠŸèƒ½ï¼Œä¸‹é¢æ˜¯å¦‚ä½•ä½¿ç”¨ Sanic Blueprint åŠŸèƒ½çš„ä¸€äº›å…³é”®æ¦‚å¿µå’Œæ­¥éª¤ï¼šï¼š<br>

1. å¯¼å…¥ Sanic å’Œ Blueprintï¼š

```python
from sanic import Sanic
from sanic import Blueprint
```

2. åˆ›å»ºä¸€ä¸ª Sanic åº”ç”¨ç¨‹åºå’Œä¸€ä¸ªæˆ–å¤šä¸ª Blueprintï¼š

```python
app = Sanic(__name__)
bp = Blueprint('my_blueprint', url_prefix='/my_blueprint')
```

3. åœ¨ Blueprint ä¸­å®šä¹‰è·¯ç”±å’Œè§†å›¾å‡½æ•°ï¼š

> `async def index()`éƒ¨åˆ†è¢«ç§°ä¸ºè§†å›¾å‡½æ•°ã€‚

```python
@bp.route('/')
async def index(request):
    return sanic.response.text('This is the index page of my_blueprint.')

@bp.route('/about')
async def about(request):
    return sanic.response.text('This is the about page of my_blueprint.')
```

4. å°† Blueprint æ³¨å†Œåˆ°åº”ç”¨ç¨‹åºä¸­ï¼š

```python
app.blueprint(bp)
```

5. æ·»åŠ è¿è¡Œè„šæœ¬ï¼š

```python
if __name__ == "__main__":
    app.run(host="0.0.0.0", port=8848)
```

ä½¿ç”¨ Blueprint çš„ä¸»è¦å¥½å¤„æ˜¯ï¼Œå®ƒå…è®¸ä½ å°†åº”ç”¨ç¨‹åºæ‹†åˆ†ä¸ºå¤šä¸ªæ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—éƒ½æœ‰è‡ªå·±çš„è·¯ç”±å’Œè§†å›¾å‡½æ•°ï¼Œè¿™æœ‰åŠ©äºæé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚ä½ å¯ä»¥åˆ›å»ºå¤šä¸ª Blueprintï¼Œå¹¶æ ¹æ®éœ€è¦å°†å®ƒä»¬æ³¨å†Œåˆ°åº”ç”¨ç¨‹åºä¸­ï¼Œä»è€Œè½»æ¾åœ°ç®¡ç†å¤§å‹åº”ç”¨ç¨‹åºçš„è·¯ç”±å’Œè§†å›¾ã€‚

æ€»ä¹‹ï¼ŒSanic çš„ Blueprint åŠŸèƒ½æ˜¯ä¸€ç§ç»„ç»‡å’Œç®¡ç†è·¯ç”±ã€ä¸­é—´ä»¶å’Œè§†å›¾çš„å¼ºå¤§å·¥å…·ï¼Œä½¿å¾—æ„å»ºå¼‚æ­¥ web åº”ç”¨ç¨‹åºæ›´åŠ çµæ´»å’Œå¯ç»´æŠ¤ã€‚

Sanicé€šè¿‡ä½¿ç”¨è“å›¾(Blueprint)é€šè¿‡**å…¬å…±å‰ç¼€**å¯¹è·¯ç”±è¿›è¡Œå‘½åç©ºé—´éš”ç¦»:<br>

bp1 = Blueprint('blueprint1', url_prefix='/bp1')    &nbsp;&nbsp;# url_prefix è¡¨ç¤ºè¯¥è“å›¾çš„å…¬å…±å‰ç¼€ï¼›<br>
bp2 = Blueprint('blueprint2', url_prefix='/bp2')  

å³æ”¯æŒä¸‹é¢è¿™ç§å†™æ³•ï¼š  
@bp1.route("/segment", methods=["POST"])  
@bp2.route("/segment", methods=["POST"])  
  
ä¸å¿…æ‹…å¿ƒurlçš„éƒ¨åˆ†é‡å¤ï¼Œå› ä¸ºå‰ç¼€ä¸ä¸€æ ·ï¼Œæ‰€ä»¥å¯¹åº”çš„ç½‘å€ä¹Ÿä¸ä¸€æ ·ã€‚<br>
```python
http://localhost:8000/bp1/segment
http://localhost:8000/bp2/segment  
```